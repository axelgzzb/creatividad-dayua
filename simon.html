<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Protocolo de seguridad</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');
  body {
    margin: 0; padding: 0;
    background: #000;
    font-family: 'Share Tech Mono', monospace;
    color: #00ff99;
    display: flex;
    flex-direction: column;
    align-items: center;
    height: 100vh;
    user-select: none;
  }

  h1 {
    margin-top: 1rem;
    font-size: 2.2rem;
    text-shadow: 0 0 12px #00ff99;
  }

  #game-container {
    margin-top: 2rem;
    display: grid;
    grid-template-columns: repeat(2, 140px);
    grid-gap: 30px;
  }

  .btn-simon {
    width: 140px;
    height: 140px;
    border-radius: 20px;
    box-shadow: 0 0 20px #000;
    cursor: pointer;
    transition: filter 0.2s ease;
    filter: brightness(0.6);
  }

  .btn-simon.active {
    filter: brightness(1.3);
    box-shadow:
      0 0 15px #fff,
      0 0 30px var(--glow-color),
      0 0 40px var(--glow-color),
      0 0 60px var(--glow-color);
  }

  #btn-green { background: #00ff99; --glow-color: #00ff99; }
  #btn-blue  { background: #3399ff; --glow-color: #3399ff; }
  #btn-pink  { background: #ff33cc; --glow-color: #ff33cc; }
  #btn-yellow{ background: #ffff33; --glow-color: #ffff33; }

  #message {
    margin-top: 2rem;
    min-height: 40px;
    font-size: 1.2rem;
    text-align: center;
    text-shadow: 0 0 8px #00ff99;
  }

  #btn-reset {
    margin-top: 3rem;
    background: none;
    border: 2px solid #00ff99;
    color: #00ff99;
    padding: 10px 25px;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1rem;
    border-radius: 15px;
    cursor: pointer;
    text-transform: uppercase;
    box-shadow: 0 0 8px #00ff99;
    transition: background-color 0.3s ease;
    display: none;
  }

  #btn-reset:hover { background-color: #00ff9977; }

  .glitch {
    position: relative;
    color: #ff0040;
    animation: glitchAnim 1.2s infinite;
    font-weight: bold;
    text-shadow: 2px 0 red, -2px 0 cyan;
  }

  @keyframes glitchAnim {
    0%, 80%, 100% { text-shadow: 2px 0 red, -2px 0 cyan; }
    20%, 60% { text-shadow: -2px 0 red, 2px 0 cyan; }
    40% { text-shadow: 2px 0 cyan, -2px 0 red; }
  }

  /* C√°mara falsa */
  #camera-interface {
    display: none;
    margin-top: 3rem;
  }

  .camera-interface {
    width: 640px;
    height: 480px;
    background: #111;
    border: 6px solid #00ff99;
    border-radius: 16px;
    position: relative;
    box-shadow: 0 0 20px #00ff99;
    overflow: hidden;
  }

  .camera-header {
    position: absolute;
    top: 10px;
    left: 10px;
    font-size: 1rem;
    color: #ff4444;
    font-weight: bold;
  }

  .rec-dot {
    display: inline-block;
    width: 10px;
    height: 10px;
    background: red;
    border-radius: 50%;
    margin-right: 5px;
    animation: blink 1s infinite;
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0; }
  }

  .reticle {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 60%;
    height: 60%;
    border: 2px dashed #00ff99;
    transform: translate(-50%, -50%);
    opacity: 0.4;
  }

  .bottom-bar {
    position: absolute;
    bottom: 10px;
    left: 20px;
    right: 20px;
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: #ccc;
    opacity: 0.6;
  }

  .glitch-layer {
    position: absolute;
    width: 100%;
    height: 100%;
    background: repeating-linear-gradient(
      0deg,
      rgba(255,255,255,0.02),
      rgba(255,255,255,0.02) 2px,
      transparent 2px,
      transparent 4px
    );
    animation: glitch 1s infinite;
  }

  @keyframes glitch {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-1px); }
  }
</style>
</head>
<body>
  <h1>Protocolo de Seguridad</h1>
  <div id="game-container">
    <div class="btn-simon" id="btn-green" data-color="green"></div>
    <div class="btn-simon" id="btn-blue" data-color="blue"></div>
    <div class="btn-simon" id="btn-pink" data-color="pink"></div>
    <div class="btn-simon" id="btn-yellow" data-color="yellow"></div>
  </div>

  <div id="message">Pulsa cualquier bot√≥n para iniciar el protocolo</div>
  <button id="btn-reset">Reiniciar prueba</button>

  <!-- C√°mara falsa -->
  <div id="camera-interface">
    <div class="camera-interface">
      <div class="camera-header">
        <span class="rec-dot"></span>REC 00:01
      </div>
      <div class="reticle"></div>
      <div class="glitch-layer"></div>
      <div class="bottom-bar">
        <div>üìÅ cam_log_0425.tmp</div>
        <div>üîã 98%</div>
      </div>
    </div>
  </div>

<script>
  const buttons = {
    green: document.getElementById('btn-green'),
    blue: document.getElementById('btn-blue'),
    pink: document.getElementById('btn-pink'),
    yellow: document.getElementById('btn-yellow'),
  };

  let sequence = [];
  let playerSequence = [];
  let level = 0;
  let acceptingInput = false;

  const audioContext = new (window.AudioContext || window.webkitAudioContext)();
  const frequencies = {
    green: 329.63,
    blue: 261.63,
    pink: 392.00,
    yellow: 196.00,
  };

  function playSound(color) {
    const osc = audioContext.createOscillator();
    const gainNode = audioContext.createGain();
    osc.connect(gainNode);
    gainNode.connect(audioContext.destination);
    osc.frequency.value = frequencies[color];
    osc.type = 'sine';
    gainNode.gain.setValueAtTime(0.15, audioContext.currentTime);
    osc.start();
    setTimeout(() => {
      gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.3);
      osc.stop(audioContext.currentTime + 0.3);
    }, 100);
  }

  function lightUp(color) {
    return new Promise(resolve => {
      buttons[color].classList.add('active');
      playSound(color);
      setTimeout(() => {
        buttons[color].classList.remove('active');
        setTimeout(resolve, 150);
      }, 400);
    });
  }

  function getRandomColor() {
    const colors = Object.keys(buttons);
    return colors[Math.floor(Math.random() * colors.length)];
  }

  async function playSequence() {
    acceptingInput = false;
    for (const color of sequence) {
      await lightUp(color);
    }
    acceptingInput = true;
    document.getElementById('message').textContent = `Repite la secuencia - Nivel ${level}`;
  }

  function resetGame() {
    sequence = [];
    playerSequence = [];
    level = 0;
    acceptingInput = false;
    document.getElementById('message').textContent = 'Pulsa cualquier bot√≥n para iniciar el protocolo';
    document.getElementById('btn-reset').style.display = 'none';
    document.getElementById('game-container').style.display = 'grid';
    document.getElementById('camera-interface').style.display = 'none';
  }

  function showErrorMessage() {
    const message = document.getElementById('message');
    message.innerHTML = `<span class="glitch">‚ö†Ô∏è ERROR: Protocolo inestable. Reinicie el sistema.</span>`;
    acceptingInput = false;
    document.getElementById('btn-reset').style.display = 'inline-block';
  }

  async function nextLevel() {
    level++;
    document.getElementById('message').textContent = `Nivel ${level}: Observa y memoriza`;
    sequence.push(getRandomColor());
    playerSequence = [];
    await new Promise(r => setTimeout(r, 800));
    await playSequence();
  }

  function launchCamera() {
    document.getElementById('game-container').style.display = 'none';
    document.getElementById('btn-reset').style.display = 'none';
    document.getElementById('message').textContent = '‚úÖ COMPLETADO. REDIRIGIENDO...';
    setTimeout(() => {
      document.getElementById('message').textContent = 'üõ°Ô∏è Acceso autorizado.';
      document.getElementById('camera-interface').style.display = 'block';
    }, 5000);
  }

  Object.entries(buttons).forEach(([color, btn]) => {
    btn.addEventListener('click', async () => {
      if (!acceptingInput && level > 0) return;

      if (level === 0) {
        await nextLevel();
        return;
      }

      playerSequence.push(color);
      playSound(color);
      btn.classList.add('active');
      setTimeout(() => btn.classList.remove('active'), 200);

      const currentIndex = playerSequence.length - 1;
      if (playerSequence[currentIndex] !== sequence[currentIndex]) {
        showErrorMessage();
        return;
      }

      if (playerSequence.length === sequence.length) {
        if (level === 6) {
          document.getElementById('message').textContent = "‚úî Protocolo completado con √©xito.";
          acceptingInput = false;
          setTimeout(launchCamera, 1500);
        } else {
          await new Promise(r => setTimeout(r, 800));
          await nextLevel();
        }
      }
    });
  });

  document.getElementById('btn-reset').addEventListener('click', resetGame);
</script>
</body>
</html>
